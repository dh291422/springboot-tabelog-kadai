<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">    
   <head>
       <div th:replace="~{fragment :: meta}"></div>   
            
       <div th:replace="~{fragment :: styles}"></div>
         
       <title>店舗一覧</title>   
   </head>
   <body>
       <div class="nagoyameshi-wrapper">
           <!-- ヘッダー -->
           <div th:replace="~{fragment :: header}"></div>
           
           <main>
               <div class="container nagoyameshi-container pb-5">
				<div class="row justify-content-center">
				    <!-- 左カラム：検索フォーム -->
				    <div class="col-xl-3 col-lg-4 col-md-12 mb-4">
				        <div class="card h-100">
				            <div class="card-header">絞り込み検索</div>
				            <div class="card-body">
				                <form method="get" th:action="@{/restaurants}">
				                    <!-- キーワード -->
				                    <div class="input-group mb-3">
				                        <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="店舗名・目的地">
				                    </div>

				                    <!-- カテゴリ -->
				                    <div class="mb-3">
				                        <label class="form-label">カテゴリ</label>
				                        <select class="form-select" name="category">
				                            <option value="" hidden>選択してください</option>
				                            <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}" th:selected="${category == cat}"></option>
				                        </select>
				                    </div>

				                    <!-- 価格帯 -->
				                    <div class="mb-3">
				                        <label class="form-label">価格帯</label>
				                        <select class="form-select" name="lowestPrice">
				                            <option value="" hidden>選択してください</option>
				                            <option value="1000" th:selected="${lowestPrice == 1000}">1,000円以内</option>
				                            <option value="2000" th:selected="${lowestPrice == 2000}">2,000円以内</option>
				                            <option value="3000" th:selected="${lowestPrice == 3000}">3,000円以内</option>
				                            <option value="4000" th:selected="${lowestPrice == 4000}">4,000円以内</option>
				                            <option value="5000" th:selected="${lowestPrice == 5000}">5,000円以内</option>
				                        </select>
				                    </div>

				                    <!-- 並び替え -->
				                    <div class="mb-3">
				                        <label class="form-label">並び替え</label>
				                        <select class="form-select" name="order">
				                            <option value="createdAtDesc" th:selected="${order == 'createdAtDesc' || order == null}">新着順</option>
				                            <option value="lowestPriceAsc" th:selected="${order == 'lowestPriceAsc'}">価格帯が安い順</option>
				                            <option value="lowestPriceDesc" th:selected="${order == 'lowestPriceDesc'}">価格帯が高い順</option>
				                        </select>
				                    </div>

				                    <!-- 検索ボタン -->
				                    <div>
				                        <button type="submit" class="btn btn-primary w-100">検索</button>
				                    </div>
				                </form>
				            </div>
				        </div>
				    </div>

				    <!-- 右カラム：店舗一覧 -->
				    <div class="col-xl-9 col-lg-8 col-md-12">
				        <p th:if="${restaurantPage.getTotalPages() > 1}" class="fs-5 mb-3"
				           th:text="${'検索結果：' + restaurantPage.getTotalElements() + '件（' + (restaurantPage.getNumber() + 1) + ' / ' + restaurantPage.getTotalPages() + 'ページ）'}">
				        </p>
				        <p th:unless="${restaurantPage.getTotalPages() > 1}" class="fs-5 mb-3"
				           th:text="${'検索結果：' + restaurantPage.getTotalElements() + '件'}"></p>

				        <!-- 店舗カード -->
				        <div class="mb-3" th:each="restaurant : ${restaurantPage}">
				            <!-- 中略：ここに各店舗のカード表示を入れてください（元のままでOK） -->
				        </div>

				        <!-- ページネーション -->
				        <div th:if="${restaurantPage.getTotalPages() > 1}" class="d-flex justify-content-center">
				            <nav aria-label="店舗一覧ページ">
				                <ul class="pagination">
				                    <!-- 前へ -->
				                    <li class="page-item">
				                        <span th:if="${restaurantPage.isFirst()}" class="page-link disabled">前</span>
				                        <a th:unless="${restaurantPage.isFirst()}" th:href="@{/restaurants(page=${restaurantPage.getNumber() - 1}, keyword=${keyword}, category=${category}, lowestPrice=${lowestPrice}, order=${order})}" class="page-link">前</a>
				                    </li>

				                    <!-- ページ番号 -->
				                    <li th:each="i : ${#numbers.sequence(0, restaurantPage.totalPages - 1)}" class="page-item">
				                        <span th:if="${i == restaurantPage.number}" class="page-link active" th:text="${i + 1}"></span>
				                        <a th:unless="${i == restaurantPage.number}" th:href="@{/restaurants(page=${i}, keyword=${keyword}, category=${category}, lowestPrice=${lowestPrice}, order=${order})}" class="page-link" th:text="${i + 1}"></a>
				                    </li>

				                    <!-- 次へ -->
				                    <li class="page-item">
				                        <span th:if="${restaurantPage.isLast()}" class="page-link disabled">次</span>
				                        <a th:unless="${restaurantPage.isLast()}" th:href="@{/restaurants(page=${restaurantPage.getNumber() + 1}, keyword=${keyword}, category=${category}, lowestPrice=${lowestPrice}, order=${order})}" class="page-link">次</a>
				                    </li>
				                </ul>
				            </nav>
				        </div>
				    </div>
				</div>  
 </body>
</html>
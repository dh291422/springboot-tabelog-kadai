package com.example.nagoyameshi.controller;

import jakarta.validation.Valid;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.example.nagoyameshi.form.CompanyForm;

@Controller
public class CompanyController {

    // 会社情報表示（誰でも）
    @GetMapping("/company")
    public String showCompanyPage() {
        return "company/company";
    }

    // 編集画面表示（管理者のみ）
    @GetMapping("/company/edit")
    public String editCompanyPage(Model model) {
        if (!model.containsAttribute("companyForm")) {
            CompanyForm companyForm = new CompanyForm();
            companyForm.setName("NAGOYAMESHI株式会社");
            companyForm.setCeo("侍太郎");
            companyForm.setEstablished("2022-09-01");
            companyForm.setPostal("1234567");
            companyForm.setAddress("東京都侍区侍町1-2-3");
            companyForm.setBusiness("飲食店の検索・予約サービス");
            model.addAttribute("companyForm", companyForm);
        }
        return "company/edit";
    }

    // 編集内容送信（管理者のみ）
    @PostMapping("/company/edit")
    public String updateCompanyInfo(
            @ModelAttribute("companyForm") @Valid CompanyForm companyForm,
            BindingResult bindingResult,
            Model model,
            RedirectAttributes redirectAttributes
    ) {
        if (bindingResult.hasErrors()) {
            // エラー時にメッセージを表示する
            model.addAttribute("errorMessage", "入力誤りがあります。内容を確認してください。");
            return "company/edit";
        }

        // 正常時の処理（保存など）
        // 例: companyService.update(companyForm);

        redirectAttributes.addFlashAttribute("successMessage", "会社情報を更新しました。");
        return "redirect:/company";
    }
}
